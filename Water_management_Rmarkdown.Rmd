---
title: "Presentation"
author: "Water Management Project Group"
date: "2023-06-16"
output: html_document
---
#Drip Irrigation adoption in Kenya Irrigation schemes
#Inroduction
Why that Decision- ?
Due to Climate change effects especially the increased events of drought conditions in Kenya, there is a need for proper management and utilization of water resources. Surface irrigation system comprises the biggest percentage in Kenya Irrigation Schemes thus drawing a lot of water from the landscape and negative effect cosharing entities. Therefore we want the government of Kenya to buy into the idea of Drip Irrigation as a sustainable water management approach in the various Irrigation Schemes.

Decision Makers- 
Government of Kenya will be the Decision Makers who also do stakeholder analysis.


#The Project`s Stakeholders 
 The individual/group who has interests/can affect/ is affected by the decision.

After brainstorming and with the help of the STRATEGIC PLAN (2019-2023) by National Irrigation Authority, decided to work on 14 stakeholders.
For each of them, defined : 
      -Roles
      -Major one
      -Rated : 
              -Capital availability
              -Influence
              -Expertise

In the purpose of analyse it and define most important stakeholders and the decision maker
Plot #capital availability, #expertise,  #influence.
```{r}
library(ggplot2)
library(ggrepel)
library(ggthemes)
library(readxl)
library(dplyr)

stakeholder<-Stakeholder_Management_data <- read.csv("C:/Users/oyiey/OneDrive/Dokumente/UniBonn SS2023/DecisionAnalysis/Dripprojectdata.csv") 
                                                       col_types = c("text", "text", "text", 
                                                                     "numeric", "numeric", "numeric", 
                                                                     "numeric", "numeric")

#print(Stakeholder_Management_data)

ggplot(data = stakeholder, aes(x = Expertise, 
                               y = Capital_Availability, 
                               label = Stakeholders, 
                               color = Influence))+  
  geom_point() +
  xlab("Expertise") +
  
  #label names of stakeholders and expand space to show full names
  scale_x_continuous(labels = paste(seq(0, 5, by = 1)), 
                     breaks = seq(0, 5, by = 1), 
                     limits = c(0, 5),
                     expand = c(0, 1)) +
  scale_y_continuous(labels = paste(seq(0, 5, by = 1)), 
                     breaks = seq(0, 5, by = 1), 
                     limits = c(0, 5),
                     expand = c(0, 1)) +
  theme(plot.margin = unit(c(1, 1, 1, 1), "cm")) +
  theme(legend.position = "none") +
  
  # Create line to categorize stakeholders
  geom_hline(yintercept=2.5, color="white", size=2) +
  geom_vline(xintercept=2.5, color="white", size=2) +
  
  # Show all names of overlapped values
  geom_text_repel(box.padding = 0.3, max.overlaps = Inf, size = 3) +
  annotate("text", label = "Potential core experts",
           x = 4.5, y = 3.5, size = 5, color = "grey48") +
  annotate("text", label = "Resource persons",
           x = 4.5, y = 0.25, size = 5, color = "grey48")

```

Government, NGO, irrigation authority = most important (as expected) 
It confirms our choice to work with the Government as the decision maker.




# Conceptual model

Developing this framework opt to include at least most of all the uncertainties, benefits and negative consequences likely to be encountered.
We looked at both short term and long term benefits and general cost for the project.
Government always looks at the social economic value and the viability of the project before making decision to adopt and allocate resources.

## Slide with R Output

```{r}
library(imager)
Conceptual_model <- load.image("C:/Users/oyiey/Downloads/Conceptual model (1).png")
plot(Conceptual_model)

```





23rd June 2023

Presentation 

Our presentation of today is more about the codes used to generate the models and explanation behind it.
Creation of the impact pathway.
```{r}
library(DiagrammeR)
mermaid(diagram = "graph LR
    Y(Yield)-->Ag(AgricIncome); linkStyle 0 stroke: blue, stroke-width:1.5px
    Mg(Management)-->Ag; linkStyle 1 stroke: blue, stroke-width:1.5px
    WB(Watersource)-->Ex(ExternalIncome); linkStyle 2 stroke: blue, stroke-width:1.5px
    Ag-->TP(TotalProfit); linkStyle 3 stroke:blue, stroke-width: 1.5px
    Ex-->TP; linkStyle 4 stroke: blue, stroke-width: 1.5px
    In(InstallCost)-->TC(Total_Cost); linkStyle 5 stroke: red, stroke-width:1.5px
    MngtC(ManagementCost)-->TC; linkStyle 6 stroke: red, stroke-width: 1.5px
    TP-->NP(NetProfit); linkStyle 7 stroke: blue, stroke-width: 1.5px
    TC-->NP; linkStyle 8 stroke: red, stroke-width: 1.5px")

```                   


Model building

```{r}
library(decisionSupport)
dripline_estimates <- data.frame(variable = c("Yield","Marketvalue", "Management", "Watersource", 
                                              "Nutrition", "Powergeneration", "Establishmentcost", 
                                           "Managementcost"),
                              lower = c(25, 5, 10, 6, 3, 5, 18, 8),                  #Values *10K
                              median = NA,
                              upper = c(90, 20, 39, 20, 13, 17, 81, 34),             #Values *10K 
                              distribution = c("posnorm", "posnorm", "posnorm", "posnorm", "posnorm", 
                                               "posnorm", "posnorm", "posnorm"),
                              label = c("Yield (kg/ha)", "Price (ksh/kg)", "management_savings(ksh)", 
                                        "Basinprofits(ksh)", "Nutrientgain(ksh)",
                                        "Electricity(ksh/Kw)", "instalationcost(ksh", "managementcost(Ksh)"),
                              Description = c("Yield of the maize crop", "Market price per KG of maize grain", 
                                              "Reduced cost of weed management",
                                              "Benefits generated from efficient water use from basin", 
                                              "Value of food nutrient generated", 
                                              "Kw of electricity increased by increased water levels", 
                                              "Cost of generating installing the project", 
                                              "Cost of project maintainance"))
dripline_estimates

dripmodel_function <- function(){
  #The model_function
  # Estimate the income in a normal season
  AgriIncome <- (Yield*Marketvalue) + Management 
  ExtIncome <- Watersource + Nutrition + Powergeneration
  TotalProfits <- AgriIncome + ExtIncome
  
  # Estimate the overall costs
  Overallcosts<- Establishmentcost + Managementcost
  
  # Estimate the final results from the model
  final_result <- TotalProfits - Overallcosts
  
  # Generate the list of outputs from the Monte Carlo simulation
  return(list(final_result = final_result))
  }

dripline_mc_simulation <- mcSimulation(estimate = as.estimate(dripline_estimates),
                                       model_function = dripmodel_function,
                                       numberOfModelRuns = 800,
                                       functionSyntax = "plainNames")
#dripline_mc_simulation

plot_distributions(mcSimulation_object = dripline_mc_simulation,
                   vars = "final_result",
                   method = "boxplot_density",
                   old_names = "final_result",
                   new_names = "Outcome distribution for profits")


``` 

#Value estimates
#### SURFACE IRRIGATION ####
#surface irrigation pathway

```{r}
library(igraph)
SurfaceIrr_path<-graph.formula(SurfaceIrr-+Yield,
                               SurfaceIrr-+Incomes,
                               SurfaceIrr-+Management,
                               MaintenanceCost-+SurfaceIrr,
                               MaintenanceCost-+TotalCost,
                               Incomes-+TotalBenefits,
                               Management-+TotalBenefits,
                               Yields-+TotalBenefits,
                               TotalBenefits-+CurrentSituationOutcome,
                               TotalCost-+CurrentSituationOutcome)
#plot(SurfaceIrr_path)

SurfaceIrr_Path<-graph.formula()

#surface Irrigation estimates
library(decisionSupport)
SurfaceIrr_estimates <- data.frame(variable = c("Yield","Management","Incomes","Maintenancecost"),
                                   lower = c(14, 2, 20, 4),
                                   median = NA,
                                   upper = c(20, 10, 23, 10),
                                   distribution = c("posnorm","posnorm","posnorm","posnorm"),
                                   label = c("Yield (kg/ha)","Savings","Incomes (Ksh)","managementcost(Ksh)"),
                                   Description = c("Total Yields (Ksh","Savings from Management (Ksh)","All incomes earned (Ksh)","Cost of project maintainance"))

View(SurfaceIrr_estimates)

#Surface Irrigation Function
SurfaceIrr_function <- function(){
  TotalBenefits <-(Yield+Management+Incomes)
  TotalCost<-Maintenancecost
  final_result<-TotalBenefits-TotalCost
  return(list(final_result = final_result))
}

# Monte-Carlo simulation
SurfaceIrr_mc_simulation <- mcSimulation(estimate = as.estimate(SurfaceIrr_estimates),
                                         model_function = SurfaceIrr_function,
                                         numberOfModelRuns = 800,
                                         functionSyntax = "plainNames")


#Plot distribution
plot_distributions(mcSimulation_object = SurfaceIrr_mc_simulation,
                   vars = "final_result",
                   method = "boxplot_density",
                   old_names = "final_result",
                   new_names = "Outcome distribution for profits")
``` 
                   NOTE:    We hope to smooth the flow of the project 



